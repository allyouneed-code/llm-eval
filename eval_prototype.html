<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenCompass æ¨¡å‹è¯„æµ‹å¹³å° - åŸå‹</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>

    <style>
        body { margin: 0; font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif; background-color: #f5f7fa; }
        .el-container { height: 100vh; }
        .el-aside { background-color: #001529; color: #fff; transition: width 0.3s; }
        .logo { height: 60px; line-height: 60px; text-align: center; font-size: 20px; font-weight: bold; background-color: #002140; color: #fff; border-bottom: 1px solid #001529; }
        .el-menu { border-right: none; }
        .el-header { background-color: #fff; box-shadow: 0 1px 4px rgba(0,21,41,.08); display: flex; align-items: center; justify-content: space-between; }
        .main-card { min-height: 80vh; }
        
        /* é”™é¢˜æœ¬æ ·å¼ */
        .bad-case-diff { display: flex; gap: 20px; font-size: 14px; }
        .diff-box { flex: 1; padding: 15px; border-radius: 4px; border: 1px solid #dcdfe6; background: #fff; }
        .diff-box h4 { margin-top: 0; color: #606266; border-bottom: 1px solid #ebeef5; padding-bottom: 10px; }
        .highlight-err { background-color: #fef0f0; color: #f56c6c; padding: 2px 4px; border-radius: 2px; }
        
        /* é›·è¾¾å›¾å®¹å™¨ */
        #radar-chart { width: 100%; height: 400px; }
    </style>
</head>
<body>
    <div id="app">
        <el-container>
            <el-aside width="220px">
                <div class="logo">ğŸ§­ OpenCompass</div>
                <el-menu
                    active-text-color="#409EFF"
                    background-color="#001529"
                    text-color="#fff"
                    :default-active="activeMenu"
                    @select="handleMenuSelect"
                >
                    <el-menu-item index="1">
                        <el-icon><monitor /></el-icon>
                        <span>æ§åˆ¶å° (Dashboard)</span>
                    </el-menu-item>
                    <el-menu-item index="2">
                        <el-icon><files /></el-icon>
                        <span>èµ„äº§ç®¡ç†</span>
                    </el-menu-item>
                    <el-menu-item index="3">
                        <el-icon><video-play /></el-icon>
                        <span>æ–°å»ºè¯„æµ‹</span>
                    </el-menu-item>
                    <el-menu-item index="4">
                        <el-icon><data-analysis /></el-icon>
                        <span>ç»“æœè¯Šæ–­</span>
                    </el-menu-item>
                </el-menu>
            </el-aside>

            <el-container>
                <el-header>
                    <div style="font-weight: bold; font-size: 16px;">{{ pageTitle }}</div>
                    <div>
                        <el-avatar :size="32" src="https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"></el-avatar>
                        <span style="margin-left: 10px; font-size: 14px; color: #606266;">Admin</span>
                    </div>
                </el-header>

                <el-main>
                    <el-card v-if="activeMenu === '3'" class="main-card">
                        <template #header>
                            <div class="card-header">
                                <span>åˆ›å»ºæ–°ä»»åŠ¡</span>
                            </div>
                        </template>
                        
                        <el-steps :active="activeStep" finish-status="success" simple style="margin-bottom: 30px;">
                            <el-step title="é€‰æ‹©æ¨¡å‹" icon="Cpu"></el-step>
                            <el-step title="é…ç½®èƒ½åŠ›" icon="Connection"></el-step>
                            <el-step title="ç¡®è®¤æäº¤" icon="Upload"></el-step>
                        </el-steps>

                        <div v-if="activeStep === 0" style="max-width: 600px; margin: 0 auto;">
                            <el-form label-position="top">
                                <el-form-item label="ç›®æ ‡æ¨¡å‹ (Model)">
                                    <el-select v-model="form.model" placeholder="è¯·é€‰æ‹©å·²æ³¨å†Œçš„æ¨¡å‹" style="width: 100%">
                                        <el-option label="Llama3-8B-Finance-v1 (æœ¬åœ°)" value="llama3"></el-option>
                                        <el-option label="Qwen-72B-Chat (API)" value="qwen"></el-option>
                                    </el-select>
                                </el-form-item>
                                
                                <el-alert v-if="form.model === 'llama3'" title="èµ„æºæ£€æµ‹é€šè¿‡ï¼šå½“å‰ GPU æ˜¾å­˜ç©ºé—² (22GB / 24GB)" type="success" show-icon :closable="false"></el-alert>
                                
                                <el-form-item label="è¯„æµ‹å‚æ•° (Inference Config)" style="margin-top: 20px;">
                                    <el-col :span="11">
                                        <el-form-item label="Temperature">
                                            <el-input-number v-model="form.temp" :step="0.1" :min="0" :max="1"></el-input-number>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="11" :offset="2">
                                        <el-form-item label="Top P">
                                            <el-input-number v-model="form.top_p" :step="0.1" :min="0" :max="1"></el-input-number>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                
                                <el-button type="primary" @click="nextStep" style="width: 100%; margin-top: 20px;">ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©èƒ½åŠ›</el-button>
                            </el-form>
                        </div>

                        <div v-if="activeStep === 1" style="max-width: 800px; margin: 0 auto;">
                            <el-divider content-position="left">é¢„ç½®å¥—é¤ (Presets)</el-divider>
                            <el-radio-group v-model="form.preset" style="margin-bottom: 20px;" @change="handlePresetChange">
                                <el-radio-button label="finance">ğŸ’° é‡‘èè¡Œä¸šä¸“é¡¹</el-radio-button>
                                <el-radio-button label="coding">ğŸ’» ä»£ç èƒ½åŠ›ä¸“é¡¹</el-radio-button>
                                <el-radio-button label="custom">ğŸ”§ è‡ªå®šä¹‰é…ç½®</el-radio-button>
                            </el-radio-group>

                            <el-divider content-position="left">è¯¦ç»†æ•°æ®é›† (Datasets)</el-divider>
                            <el-checkbox-group v-model="form.datasets">
                                <el-row :gutter="20">
                                    <el-col :span="8" v-for="item in datasetOptions" :key="item.value" style="margin-bottom: 15px;">
                                        <el-card shadow="hover" :body-style="{ padding: '10px' }">
                                            <el-checkbox :label="item.value" size="large">{{ item.label }}</el-checkbox>
                                            <div style="font-size: 12px; color: #909399; margin-left: 24px;">{{ item.desc }}</div>
                                            <el-tag size="small" style="margin-left: 24px; margin-top: 5px;">{{ item.metric }}</el-tag>
                                        </el-card>
                                    </el-col>
                                </el-row>
                            </el-checkbox-group>

                            <div style="margin-top: 30px; display: flex; justify-content: space-between;">
                                <el-button @click="activeStep--">ä¸Šä¸€æ­¥</el-button>
                                <el-button type="primary" @click="submitTask" :loading="submitting">æäº¤è¯„æµ‹ä»»åŠ¡</el-button>
                            </div>
                        </div>

                        <div v-if="activeStep === 2" style="text-align: center; padding-top: 50px;">
                            <el-result icon="success" title="ä»»åŠ¡æäº¤æˆåŠŸ" sub-title="Task ID: 20251215-001">
                                <template #extra>
                                    <el-button type="primary" @click="goToMonitor">å»ç›‘æ§è¿›åº¦</el-button>
                                    <el-button @click="resetForm">å†æµ‹ä¸€æ¬¡</el-button>
                                </template>
                            </el-result>
                        </div>
                    </el-card>

                    <div v-if="activeMenu === '4'">
                        <el-row :gutter="20">
                            <el-col :span="10">
                                <el-card class="box-card">
                                    <template #header>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span>èƒ½åŠ›ç”»åƒ (Model Profiling)</span>
                                            <el-switch v-model="showBaseModel" active-text="å¯¹æ¯”åŸºåº§" @change="updateChart"></el-switch>
                                        </div>
                                    </template>
                                    <div id="radar-chart"></div>
                                    <div style="text-align: center; margin-top: 10px;">
                                        <el-tag type="success">ç»¼åˆå¾—åˆ†: 68.5</el-tag>
                                        <el-tag type="info" style="margin-left: 10px;">Llama3-Base: 62.0</el-tag>
                                    </div>
                                </el-card>
                            </el-col>

                            <el-col :span="14">
                                <el-card class="box-card">
                                    <template #header>
                                        <span>æ•°æ®é›†è¯¦æƒ… (Drill Down)</span>
                                    </template>
                                    <el-table :data="reportData" style="width: 100%" height="400">
                                        <el-table-column prop="dimension" label="èƒ½åŠ›ç»´åº¦" width="100"></el-table-column>
                                        <el-table-column prop="dataset" label="æ•°æ®é›†"></el-table-column>
                                        <el-table-column prop="metric" label="æŒ‡æ ‡" width="100"></el-table-column>
                                        <el-table-column prop="score" label="å¾—åˆ†" width="80">
                                            <template #default="scope">
                                                <span :style="{ fontWeight: 'bold', color: scope.row.score < 60 ? '#F56C6C' : '#67C23A' }">
                                                    {{ scope.row.score }}
                                                </span>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="120">
                                            <template #default="scope">
                                                <el-button size="small" type="primary" plain @click="viewBadCase(scope.row)">
                                                    ğŸ”¬ è¯Šæ–­
                                                </el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </el-card>
                            </el-col>
                        </el-row>

                        <el-card style="margin-top: 20px;" v-if="currentBadCaseDataset">
                            <template #header>
                                <span>é”™é¢˜é€è§† (Bad Case Analysis) - {{ currentBadCaseDataset }}</span>
                                <el-button style="float: right; padding: 3px 0" text type="primary" @click="currentBadCaseDataset = null">å…³é—­</el-button>
                            </template>
                            
                            <div class="bad-case-diff" v-for="(item, index) in badCases" :key="index" style="margin-bottom: 20px;">
                                <div class="diff-box" style="background: #f4f4f5; flex: 0.8;">
                                    <h4>Question (é¢˜ç›®)</h4>
                                    <div>{{ item.question }}</div>
                                </div>
                                <div class="diff-box">
                                    <h4>Ground Truth (æ ‡å‡†ç­”æ¡ˆ)</h4>
                                    <div style="color: #67C23A;">{{ item.gold }}</div>
                                </div>
                                <div class="diff-box">
                                    <h4>Prediction (æ¨¡å‹å›ç­”)</h4>
                                    <div v-html="item.pred"></div>
                                    <div style="margin-top: 10px; border-top: 1px dashed #eee; padding-top: 5px;">
                                        <el-tag size="small" type="danger" effect="plain">é”™è¯¯å½’å› :</el-tag> 
                                        <el-radio-group v-model="item.reason" size="small" style="margin-left: 10px;">
                                            <el-radio-button label="å¹»è§‰"></el-radio-button>
                                            <el-radio-button label="è®¡ç®—é”™è¯¯"></el-radio-button>
                                            <el-radio-button label="é€»è¾‘ä¸é€š"></el-radio-button>
                                        </el-radio-group>
                                    </div>
                                </div>
                            </div>
                        </el-card>
                    </div>

                    <div v-if="activeMenu === '1'" style="text-align: center; color: #909399; margin-top: 100px;">
                        <h2>ğŸ“Š æ¬¢è¿ä½¿ç”¨ OpenCompass è¯„æµ‹å¹³å°</h2>
                        <p>è¯·ç‚¹å‡»å·¦ä¾§ã€Œæ–°å»ºè¯„æµ‹ã€å¼€å§‹ä½“éªŒ</p>
                    </div>
                </el-main>
            </el-container>
        </el-container>
    </div>

    <script>
        const { createApp, ref, reactive, onMounted, nextTick } = Vue;
        const { ElMessage } = ElementPlus;

        // æ³¨å†Œå›¾æ ‡
        const app = createApp({
            setup() {
                const activeMenu = ref('3'); // é»˜è®¤è¿›â€œæ–°å»ºè¯„æµ‹â€
                const activeStep = ref(0);
                const submitting = ref(false);
                const pageTitle = ref('æ–°å»ºè¯„æµ‹ä»»åŠ¡');
                const showBaseModel = ref(false);
                const currentBadCaseDataset = ref(null);

                // è¡¨å•æ•°æ®
                const form = reactive({
                    model: '',
                    temp: 0.1,
                    top_p: 0.9,
                    preset: '',
                    datasets: []
                });

                // æ¨¡æ‹Ÿæ•°æ®é›†é€‰é¡¹
                const datasetOptions = [
                    { label: 'Bank_QA_Private', value: 'bank_qa', desc: 'å†…éƒ¨ç§æœ‰é‡‘èé—®ç­”é›†', metric: 'Similarity' },
                    { label: 'C-Eval-Finance', value: 'ceval_fin', desc: 'C-Eval é‡‘èå­é›†', metric: 'Accuracy' },
                    { label: 'GSM8K', value: 'gsm8k', desc: 'å°å­¦æ•°å­¦åº”ç”¨é¢˜', metric: 'Accuracy' },
                    { label: 'HumanEval', value: 'humaneval', desc: 'Python ä»£ç ç”Ÿæˆ', metric: 'Pass@1' },
                    { label: 'TruthfulQA', value: 'truthfulqa', desc: 'æ£€æµ‹æ¨¡å‹å¹»è§‰', metric: 'MC1' },
                ];

                // æ¨¡æ‹ŸæŠ¥å‘Šæ•°æ®
                const reportData = [
                    { dimension: 'è¡Œä¸šçŸ¥è¯†', dataset: 'Bank_QA_Private', metric: 'Similarity', score: 85.2 },
                    { dimension: 'è¡Œä¸šçŸ¥è¯†', dataset: 'C-Eval-Finance', metric: 'Accuracy', score: 78.4 },
                    { dimension: 'é€»è¾‘æ¨ç†', dataset: 'GSM8K', metric: 'Accuracy', score: 45.6 }, // ä½åˆ†
                    { dimension: 'ä»£ç ç¼–ç¨‹', dataset: 'HumanEval', metric: 'Pass@1', score: 62.0 },
                    { dimension: 'å®‰å…¨æ€§', dataset: 'TruthfulQA', metric: 'MC1', score: 90.1 },
                ];

                // æ¨¡æ‹Ÿ Bad Case
                const badCases = reactive([
                    { 
                        question: 'å°æ˜æœ‰5ä¸ªè‹¹æœï¼Œåƒäº†2ä¸ªï¼Œåˆä¹°äº†3ä¸ªï¼Œç°åœ¨æœ‰å‡ ä¸ªï¼Ÿ', 
                        gold: '6ä¸ª', 
                        pred: 'å°æ˜ç°åœ¨æœ‰ <span class="highlight-err">0ä¸ª</span> è‹¹æœã€‚', // æ¨¡æ‹Ÿé«˜äº®
                        reason: '' 
                    },
                    { 
                        question: 'å…¬å¸çš„å·®æ—…æŠ¥é”€æ ‡å‡†ä¸­ï¼Œä¸€çº¿åŸå¸‚ä½å®¿è´¹ä¸Šé™æ˜¯å¤šå°‘ï¼Ÿ', 
                        gold: '600å…ƒ/æ™š', 
                        pred: 'æ ¹æ®è§„å®šï¼Œä¸€çº¿åŸå¸‚ä½å®¿è´¹ä¸Šé™ä¸º <span class="highlight-err">500å…ƒ/æ™š</span>ï¼Œä¸”å¿…é¡»æä¾›å‘ç¥¨ã€‚', 
                        reason: 'å¹»è§‰' 
                    }
                ]);

                // èœå•åˆ‡æ¢
                const handleMenuSelect = (index) => {
                    activeMenu.value = index;
                    const titles = { '1': 'æ§åˆ¶å°', '2': 'èµ„äº§ç®¡ç†', '3': 'æ–°å»ºè¯„æµ‹ä»»åŠ¡', '4': 'ç»“æœè¯Šæ–­' };
                    pageTitle.value = titles[index];
                    
                    if(index === '4') {
                        nextTick(() => { initChart(); });
                    }
                };

                // è¡¨å•é€»è¾‘
                const handlePresetChange = (val) => {
                    if (val === 'finance') form.datasets = ['bank_qa', 'ceval_fin', 'truthfulqa'];
                    if (val === 'coding') form.datasets = ['humaneval', 'gsm8k'];
                };

                const nextStep = () => {
                    if (!form.model) return ElMessage.error('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¨¡å‹');
                    activeStep.value = 1;
                };

                const submitTask = () => {
                    if (form.datasets.length === 0) return ElMessage.warning('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ•°æ®é›†');
                    submitting.value = true;
                    // æ¨¡æ‹Ÿ API å»¶è¿Ÿ
                    setTimeout(() => {
                        submitting.value = false;
                        activeStep.value = 2;
                        ElMessage.success('æäº¤æˆåŠŸï¼');
                    }, 1000);
                };

                const goToMonitor = () => {
                    activeMenu.value = '4'; // ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œç›´æ¥è·³è½¬åˆ°ç»“æœé¡µ
                    pageTitle.value = 'ç»“æœè¯Šæ–­';
                    nextTick(() => { initChart(); });
                };

                const resetForm = () => {
                    activeStep.value = 0;
                    form.datasets = [];
                };

                // å›¾è¡¨é€»è¾‘
                let myChart = null;
                const initChart = () => {
                    const chartDom = document.getElementById('radar-chart');
                    if (!chartDom) return;
                    myChart = echarts.init(chartDom);
                    updateChart();
                };

                const updateChart = () => {
                    if (!myChart) return;
                    
                    const option = {
                        legend: { data: ['å½“å‰æ¨¡å‹ (Llama3-Fin)', 'åŸºåº§æ¨¡å‹ (Llama3-Base)'] },
                        radar: {
                            indicator: [
                                { name: 'è¡Œä¸šçŸ¥è¯†', max: 100 },
                                { name: 'é€»è¾‘æ¨ç†', max: 100 },
                                { name: 'è¯­è¨€ç†è§£', max: 100 },
                                { name: 'ä»£ç ç¼–ç¨‹', max: 100 },
                                { name: 'å®‰å…¨æ€§', max: 100 }
                            ]
                        },
                        series: [{
                            type: 'radar',
                            data: [
                                {
                                    value: [82, 45, 88, 62, 90],
                                    name: 'å½“å‰æ¨¡å‹ (Llama3-Fin)',
                                    itemStyle: { color: '#409EFF' },
                                    areaStyle: { opacity: 0.3 }
                                },
                                showBaseModel.value ? {
                                    value: [60, 55, 80, 60, 85], // æ¨¡æ‹ŸåŸºåº§æ•°æ®
                                    name: 'åŸºåº§æ¨¡å‹ (Llama3-Base)',
                                    itemStyle: { color: '#909399' },
                                    lineStyle: { type: 'dashed' }
                                } : null
                            ].filter(Boolean)
                        }]
                    };
                    myChart.setOption(option);
                };

                const viewBadCase = (row) => {
                    currentBadCaseDataset.value = row.dataset;
                    // çœŸå®åœºæ™¯ä¸‹è¿™é‡Œåº”è¯¥è°ƒç”¨ API è·å–è¯¥æ•°æ®é›†çš„é”™é¢˜
                    ElMessage.info(`æ­£åœ¨åŠ è½½ ${row.dataset} çš„é”™é¢˜...`);
                };

                return {
                    activeMenu, activeStep, form, submitting, datasetOptions, 
                    reportData, badCases, currentBadCaseDataset, pageTitle, showBaseModel,
                    handleMenuSelect, nextStep, handlePresetChange, submitTask, 
                    goToMonitor, resetForm, updateChart, viewBadCase
                };
            }
        });

        // æ³¨å†Œ Element Plus å›¾æ ‡
        for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
            app.component(key, component)
        }
        app.use(ElementPlus);
        app.mount('#app');
    </script>
</body>
</html>